DROP TABLE IF EXISTS Program_Training;
DROP TABLE IF EXISTS Program;
DROP TABLE IF EXISTS Training_Task;
DROP TABLE IF EXISTS Training;
DROP TABLE IF EXISTS Task;
DROP TABLE IF EXISTS Exercise;
DROP TABLE IF EXISTS Trainer;
DROP TABLE IF EXISTS Person;

CREATE TABLE IF NOT EXISTS Person (
    id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    name VARCHAR(100) NOT NULL UNIQUE,
    password varchar,
    role VARCHAR(25)
);

CREATE TABLE IF NOT EXISTS Trainer (
    id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    name VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR NOT NULL,
    rating REAL
);

CREATE TABLE IF NOT EXISTS Exercise(
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR,
    muscle VARCHAR,
    description VARCHAR,
    video VARCHAR,
    image VARCHAR,
    trainer_id INTEGER REFERENCES Trainer(id) ON DELETE SET NULL
);

CREATE TABLE IF NOT EXISTS Task(
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR,
    description VARCHAR,
    exercise_id INTEGER REFERENCES Exercise(id) ON DELETE SET NULL,
    count INTEGER,
    type_count SMALLINT,
    trainer_id INTEGER REFERENCES Trainer(id) ON DELETE SET NULL
);

CREATE TABLE IF NOT EXISTS Training(
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR,
    description VARCHAR,
    trainer_id INTEGER REFERENCES Trainer(id) ON DELETE SET NULL
);

CREATE TABLE IF NOT EXISTS Training_Task(
    training_id INTEGER REFERENCES Training(id) ON DELETE SET NULL,
    task_id INTEGER REFERENCES Task(id) ON DELETE SET NULL,
    PRIMARY KEY(training_id, task_id)
);

CREATE TABLE IF NOT EXISTS Program(
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR,
    description VARCHAR,
    trainer_id INTEGER REFERENCES Trainer(id) ON DELETE SET NULL
);

CREATE TABLE IF NOT EXISTS Program_Training(
    program_id INTEGER REFERENCES Program(id) ON DELETE SET NULL,
    training_id INTEGER REFERENCES Training(id) ON DELETE SET NULL,
    PRIMARY KEY(program_id, training_id)
);